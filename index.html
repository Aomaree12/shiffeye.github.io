
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"
        integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <style type="text/css">
        body {
            font-family: Kanit, sans-serif;
            background-color: #5F9EA0;
        }
        label {
            color: white;
        }
        .container {
            max-width: 600px;
        }
    </style>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
        $(document).ready(function() {
            // Initialize datepicker for start and end date fields with mm/dd/yy format.
            $('.datepicker').datepicker({
                dateFormat: 'mm/dd/yy',  // Changed to mm/dd/yy format
                changeMonth: true,
                changeYear: true,
                yearRange: "-100:+100",
                isBuddhist: true,
                showButtonPanel: true,
                closeText: '‡∏õ‡∏¥‡∏î',
                currentText: '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
                monthNames: ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
                        "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"],
                monthNamesShort: ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.",
                        "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."],
                dayNames: ["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", "‡∏û‡∏∏‡∏ò", "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ", "‡∏®‡∏∏‡∏Å‡∏£‡πå", "‡πÄ‡∏™‡∏≤‡∏£‡πå"],
                dayNamesShort: ["‡∏≠‡∏≤.", "‡∏à.", "‡∏≠.", "‡∏û.", "‡∏û‡∏§.", "‡∏®.", "‡∏™."],
                dayNamesMin: ["‡∏≠‡∏≤.", "‡∏à.", "‡∏≠.", "‡∏û.", "‡∏û‡∏§.", "‡∏®.", "‡∏™."],
                onSelect: function() {
                    calculateDays();
                }
            });
            // Also recalculate when the fields change (if typed manually).
            $("#device, #problem").on("change", calculateDays);
        });

        // Calculate the difference in days between the start date (device) and end date (problem).
        function calculateDays() {
            let startDateStr = $("#device").val();
            let endDateStr = $("#problem").val();
            if (startDateStr && endDateStr) {
                try {
                    // Parse the dates using the new format mm/dd/yy.
                    var startDate = $.datepicker.parseDate('mm/dd/yy', startDateStr);
                    var endDate = $.datepicker.parseDate('mm/dd/yy', endDateStr);
                    var diffTime = endDate - startDate;
                    // Calculate days (adding 1 to count both start and end dates)
                    var diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    if(diffDays < 0){
                        $("#place").val('');
                        return;
                    }
                    $("#place").val(diffDays + " ‡∏ß‡∏±‡∏ô");
                } catch (err) {
                    console.error("Error parsing dates: " + err);
                    $("#place").val('');
                }
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <form id="myForm" class="needs-validation my-4" novalidate>
            <div class="row">
                <div class="col-12 text-center">
                    <p class="h2 text-light">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤</p>
                </div>
            </div>
            <div class="row justify-content-start g-3">
                <div class="col-12">
                    <label for="name">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                    <input type="text" id="name" name="name" class="form-control" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•
                    </div>
                </div>
                <div class="col-12">
                    <label for="phone">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                    <select id="phone" name="phone" class="form-control" required>
                        <option value="" disabled selected>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</option>
                        <option value="‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢">‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢</option>
                        <option value="‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô">‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô</option>
                        <option value="‡∏•‡∏≤‡∏Å‡∏¥‡∏à">‡∏•‡∏≤‡∏Å‡∏¥‡∏à</option>
                        <option value="‡∏Ç‡∏≠‡∏´‡∏¢‡∏∏‡∏î">‡∏Ç‡∏≠‡∏´‡∏¢‡∏∏‡∏î</option>
                        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                    </select>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤
                    </div>
                </div>
                <div class="col-12">
                    <label for="device">‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô 01/15/23)</label>
                    <input type="text" id="device" name="device" class="form-control datepicker" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å
                    </div>
                </div>
                <div class="col-12">
                    <label for="problem">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô 01/20/23)</label>
                    <input type="text" id="problem" name="problem" class="form-control datepicker" required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏´‡∏¢‡∏∏‡∏î
                    </div>
                </div>
                <div class="col-12">
                    <label for="place">‡∏£‡∏ß‡∏°‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô</label>
                    <!-- Converted from select to a read-only input -->
                    <input type="text" id="place" name="place" class="form-control" readonly required>
                    <div class="invalid-feedback">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏´‡∏¢‡∏∏‡∏î
                    </div>
                </div>
                <div class="col-12 text-center">
                    <button type="submit" class="btn btn-warning w-100">
                        <i class="bi bi-send-fill"></i>&nbsp;‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏≤
                    </button>
                </div>
            </div>
        </form>
    </div>
    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbzJ56gGotum8a2xxLqDHbsP3Vq37_do_kDG25O9HKrwYgo43IaQeFmiNhc6BOsetGHbKA/exec';
        var uid;
        $(document).ready(() => {
            liff.init({
                liffId: '2001774463-mWwqdnnp',
                withLoginOnExternalBrowser: true
            });
            liff.ready.then(() => {
                console.log('liff ready');
            });
        });

        function submit() {
            $.LoadingOverlay('show');
            let data = {
                opt: 'savedata',
                uid: liff.getDecodedIDToken().sub,
                name: $('#name').val(),
                phone: $('#phone').val(),
                device: $('#device').val(),
                problem: $('#problem').val(),
                place: $('#place').val(),
            };
            $.ajax({
                method: "POST",
                url: scriptUrl,
                data: data,
                dataType: 'json',
                success: function (res) {
                    $.LoadingOverlay('hide');
                    if (res.status == 'success') {
                        return Swal.fire({
                            icon: 'success',
                            title: '‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
                            allowOutsideClick: false,
                            confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                        }).then(() => {
                            let flex = {
                                type: 'flex',
                                altText: 'success',
                                contents: {
                                    "type": "bubble",
                                    "body": {
                                        "type": "box",
                                        "layout": "vertical",
                                        "contents": [
                                            {
                                                "type": "box",
                                                "layout": "horizontal",
                                                "contents": [
                                                    {
                                                        "type": "box",
                                                        "layout": "vertical",
                                                        "contents": [
                                                            {
                                                                "type": "image",
                                                                "url": "" + liff.getDecodedIDToken().picture,
                                                                "aspectMode": "cover",
                                                                "size": "full"
                                                            }
                                                        ],
                                                        "cornerRadius": "100px",
                                                        "width": "72px",
                                                        "height": "72px"
                                                    },
                                                    {
                                                        "type": "box",
                                                        "layout": "vertical",
                                                        "contents": [
                                                            {
                                                                "type": "text",
                                                                "contents": [
                                                                    {
                                                                        "type": "span",
                                                                        "text": " " + data.name,
                                                                        "weight": "bold",
                                                                        "color": "#000000"
                                                                    }
                                                                ],
                                                                "size": "sm",
                                                                "wrap": true
                                                            },
                                                            {
                                                                "type": "box",
                                                                "layout": "baseline",
                                                                "contents": [
                                                                    {
                                                                        "type": "text",
                                                                        "text": "‡πÅ‡∏ü‡πâ‡∏°‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤ ü™ªüå∑‚õÑ",
                                                                        "size": "sm",
                                                                        "color": "#006EBC",
                                                                        "weight": "bold",
                                                                        "action": {
                                                                            "type": "uri",
                                                                            "label": "action",
                                                                            "uri": "https://liff.line.me/2004293530-oLA62BYv#appName=%E0%B8%88%E0%B8%AD%E0%B8%87%E0%B8%A7%E0%B8%B1%E0%B8%99%E0%B8%A5%E0%B8%B23-1001985161&group=%5B%7B%22Column%22%3A%22%E0%B8%95%E0%B8%B1%E0%B9%89%E0%B8%87%E0%B9%81%E0%B8%95%E0%B9%88%E0%B8%A7%E0%B8%B1%E0%B8%99%E0%B8%97%E0%B8%B5%E0%B9%88%22%2C%22Order%22%3A%22Descending%22%7D%5D&sort=%5B%5D&table=%E0%B8%8A%E0%B8%B5%E0%B8%951&view=%E0%B8%88%E0%B8%AD%E0%B8%87%E0%B8%A7%E0%B8%B1%E0%B8%99%E0%B8%A5%E0%B8%B2"
                                                                        }
                                                                    }
                                                                ],
                                                                "spacing": "sm",
                                                                "margin": "md"
                                                            }
                                                        ]
                                                    }
                                                ],
                                                "spacing": "xl",
                                                "paddingAll": "20px",
                                                "backgroundColor": "#96CFCF"
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤",
                                                        "weight": "bold",
                                                        "margin": "xxl",
                                                        "flex": 5,
                                                        "position": "relative",
                                                        "align": "start"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": " " + data.phone,
                                                        "flex": 5,
                                                        "align": "start",
                                                        "margin": "xs"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "‡∏•‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà",
                                                        "weight": "bold",
                                                        "margin": "xxl",
                                                        "flex": 5,
                                                        "position": "relative",
                                                        "align": "start"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": " " + data.device,
                                                        "flex": 5,
                                                        "align": "start",
                                                        "margin": "xs"
                                                    }
                                                ]
                                            },
                                            {
                                                "type": "box",
                                                "layout": "baseline",
                                                "contents": [
                                                    {
                                                        "type": "text",
                                                        "text": "‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà",
                                                        "weight": "bold",
                                                        "margin": "xxl",
                                                        "flex": 5,
                                                        "position": "relative",
                                                        "align": "start"
                                                    },
                                                    {
                                                        "type": "text",
                                                        "text": " " + data.problem,
                                                        "flex": 5,
                                                        "align": "start",
                                                        "margin": "xs"
                                                    }
                                                ]
                                            }
                                        ],
                                        "paddingAll": "0px"
                                    },
                                    "footer": {
                                        "type": "box",
                                        "layout": "vertical",
                                        "contents": [
                                            {
                                                "type": "text",
                                                "text": "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤",
                                                "position": "relative",
                                                "weight": "bold",
                                                "align": "center",
                                                "action": {
                                                    "type": "uri",
                                                    "label": "action",
                                                    "uri": "https://liff.line.me/2001774463-mWwqdnnp"
                                                }
                                            }
                                        ]
                                    },
                                    "styles": {
                                        "body": {
                                            "backgroundColor": "#F5DCE0"
                                        }
                                    }
                                }
                            };
                            liff.sendMessages([flex]).then(() => {
                                console.log("message sent");
                                liff.closeWindow();
                            });
                        });
                    }
                    return Swal.fire({
                        icon: 'error',
                        title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',
                        allowOutsideClick: false,
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
                    });
                },
                error: function (err) {
                    console.log(err);
                    $.LoadingOverlay('hide');
                    alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                }
            });
        }
    </script>
    <script>
        (() => {
            'use strict'
            const forms = document.querySelectorAll('.needs-validation');
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {
                    event.preventDefault();
                    if (!form.checkValidity()) {
                        event.stopPropagation();
                        form.classList.add('was-validated');
                        $('#myForm').find(":invalid").first().focus();
                    } else {
                        submit();
                    }
                }, false);
            });
        })();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
</body>
</html>
